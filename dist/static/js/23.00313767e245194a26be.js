webpackJsonp([23],{IddH:function(t,o){},"Z+YQ":function(t,o,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=n("mvHQ"),e=n.n(i),a=n("Dd8w"),s=n.n(a),c=n("pFYg"),r=n.n(c),l=n("6U54"),u=n("xt+v"),p=n("qWou"),d={props:{options:{type:Object,default:function(){return{}}}},data:function(){var t=this;return{network:{},coordsType:"gps",locationAddress:{},events:{init:function(o){t.map=o,t.options.init=!0,new AMap.Geocoder({city:"全国"}).getLocation(t.opt.companyAddr,function(n,i){t.getLocation(n,i,o)})}}}},computed:{opt:function(){return mui.extend(!0,{},{zoom:12,companyAddr:"苏州市金门路1200号安得装饰",isLocation:!1,isContains:!1,circleStyle:{},companyStyle:{},marker:null,locationStyle:{iconLabel:{innerHTML:""},iconStyle:""}},this.options)}},created:function(){var t=this;mui.plusReady(function(){t.network=Object(p.a)()})},methods:{getLocation:function(t,o,n){"complete"===t&&"OK"===o.info&&(this.circle=l.c(o,n,this.opt.circleStyle,this.opt.companyStyle),this.netLocation(n))},netLocation:function(){var t=this,o=this.map;3==this.network.no?this.currentPos(o,function(n){t.amapLocation(o)}):mui.os.plus?this.currentPos(o,function(t){mui.toast("当前非WIFI网络,请打开定位服务")}):this.amapLocation(o)},geocoder:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments[3];if("object"===(void 0===t?"undefined":r()(t))){t.lng=Number(t.lng),t.lat=Number(t.lat);var a=mui.extend(t,o);l.b(a,this.map,function(t){n.marker=t}),i=s()({},i,{lng:t.lng,lat:t.lat});var c=l.a(i,this.map);e(c.contains(this.position))}else{var u=new AMap.Geocoder({city:"全国"});u.getLocation(t,function(t,a){if("complete"===t&&"OK"===a.info){var s=l.c(a,n.map,i,o);e(s.contains(n.position))}})}},currentPos:function(t,o){var n=this;mui.plusReady(function(){plus.geolocation.getCurrentPosition(function(o){console.log("调用原生GPS定位"),console.log(e()(o)),n.coordsType=o.coordsType,mui.os.ios?n.transformCoord(o,function(i){console.log("经过处理"),console.log(e()(i)),n.amapLocation(t,{lat:i.result[0].y,lng:i.result[0].x},o)},function(i){n.amapLocation(t,{lat:o.coords.latitude,lng:o.coords.longitude},o)}):n.amapLocation(t,{lat:o.coords.latitude,lng:o.coords.longitude},o)},function(t){o(t)},{geocode:!0})})},transformCoord:function(t,o,n){mui.ajax({url:"http://api.map.baidu.com/geoconv/v1/?coords="+t.coords.longitude+","+t.coords.latitude+"&from=1&to=3&ak=efWzpkW5jPMcPfrcaa9wQHatiKQ5la7o",type:"GET",success:function(t){0===t.status?o(t):n(t)},error:function(t){mui.toast("请检查网络后再试")}})},amapLocation:function(t,o,n){var i=this;if(o){var e=new AMap.LngLat(o.lng,o.lat);AMap.convertFrom(e,this.coordsType,function(t,o){"complete"===t&&(i.position=[o.locations[0].lng,o.locations[0].lat],i.opt.locationStyle.lng=o.locations[0].lng,i.opt.locationStyle.lat=o.locations[0].lat,i.getLocationAddr(n),u.a.$emit("sendAddr",i.locationAddress),i.options.isContains=i.getContains(),i.options.isLocation=!0)})}else t.plugin("AMap.Geolocation",function(){var o=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"});t.addControl(o),o.getCurrentPosition(),AMap.event.addListener(o,"complete",function(o){i.opt.locationStyle.lng=o.position.lng,i.opt.locationStyle.lat=o.position.lat,i.marker?i.marker.setPosition(new AMap.LngLat(o.position.lng,o.position.lat)):l.b(i.opt.locationStyle,t,function(t){i.marker=t,console.log(t)}),i.getLocationAddr(o),u.a.$emit("sendAddr",i.locationAddress),i.position=[o.position.lng,o.position.lat],i.options.isContains=i.getContains(),i.options.isLocation=!0}),AMap.event.addListener(o,"error",function(t){})})},getContains:function(){return 0===this.opt.circleStyle.radius||this.circle.contains(this.position)},getLocationAddr:function(t){console.log(t);var o=t.coords||t.position,n=t.address||t.addressComponent,i={lat:o.latitude||o.lat||0,lng:o.longitude||o.lng||0};console.log(n);var e={province:n.province||"",city:n.city||"",district:n.district||"",street:n.street||"",streetNum:n.streetNum||n.streetNumber||"",poiName:n.poiName||"",building:n.building};this.locationAddress={position:i,address:e,formattedAddress:n.addresses||t.formattedAddress}},getLocat:function(){return this.locationAddress}}},m={render:function(){var t=this.$createElement,o=this._self._c||t;return o("div",{staticClass:"z-map-container"},[o("el-amap",{ref:"map",staticClass:"z-amap-wrap",attrs:{vid:"amap",zoom:this.opt.zoom,events:this.events,doubleClickZoom:!1}})],1)},staticRenderFns:[]};var f={data:function(){return{loc:null,options:{companyAddr:"苏州市寒山寺",isLocation:!1,isContains:!1}}},methods:{location:function(){this.$refs.map.netLocation()},getLocat:function(){this.loc=this.$refs.map.getLocat()},success:function(){var t=this.options.isLocation?"定位完成":"定位中。。。";alert(t)},punch:function(){var t=this.options.isContains?"可以打卡":"离打卡范围还有十万八千里";alert(t)}},components:{GeolocationMap:n("VU/8")(d,m,!1,function(t){n("pxab")},null,null).exports}},g={render:function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"container"},[n("div",{staticClass:"map-wrap"},[n("geolocation-map",{ref:"map",attrs:{options:t.options}})],1),t._v(" "),n("button",{staticClass:"mui-btn mui-btn-block mui-block-primary",on:{tap:t.location}},[t._v("重新定位")]),t._v(" "),n("button",{staticClass:"mui-btn mui-btn-block mui-block-primary",on:{tap:t.getLocat}},[t._v("获取位置信息")]),t._v(" "),n("div",[t._v(t._s(t.loc))]),t._v(" "),n("button",{staticClass:"mui-btn mui-btn-block mui-block-primary",on:{tap:t.success}},[t._v("定位完成了没")]),t._v(" "),n("button",{staticClass:"mui-btn mui-btn-block mui-block-primary",on:{tap:t.punch}},[t._v("是否在打卡范围")])])},staticRenderFns:[]};var v=n("VU/8")(f,g,!1,function(t){n("IddH")},"data-v-d417cb82",null);o.default=v.exports},pxab:function(t,o){},qWou:function(t,o,n){"use strict";n.d(o,"a",function(){return i});var i=function(){var t={},o={no:1,name:"无网络"};t[plus.networkinfo.CONNECTION_UNKNOW]="Unknown connection",t[plus.networkinfo.CONNECTION_NONE]="None connection",t[plus.networkinfo.CONNECTION_ETHERNET]="Ethernet connection",t[plus.networkinfo.CONNECTION_WIFI]="WiFi connection",t[plus.networkinfo.CONNECTION_CELL2G]="Cellular 2G connection",t[plus.networkinfo.CONNECTION_CELL3G]="Cellular 3G connection",t[plus.networkinfo.CONNECTION_CELL4G]="Cellular 4G connection";var n=plus.networkinfo.getCurrentType();return 3===n&&(o={no:3,name:"WIFI网络"}),n>3&&(o={no:2,name:"移动流量"}),1===n&&(o={no:1,name:"无网络"}),o}}});
//# sourceMappingURL=23.00313767e245194a26be.js.map